{% extends 'dashboard_base.html' %}

{% block title %}Dashboard | DropFlow{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .flatpickr-calendar.dark {
            background: #1e293b;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }
    </style>
{% endblock %}

{% block content %}
        <header class="h-16 flex items-center justify-between px-8 border-b border-white/5 bg-bg-dark/80 backdrop-blur-md sticky top-0 z-10">
            <div class="flex flex-col">
                <h1 class="text-xl font-bold text-white">Dashboard</h1>
                <span class="text-xs text-slate-400">Statistics</span>
            </div>
            <div class="flex items-center gap-3">
                <div class="flex bg-bg-card rounded-lg p-1 border border-white/5 text-sm">
                    <button @click="setPeriod('today')" :class="period === 'today' ? 'bg-white/10 text-white shadow-sm border border-white/5' : 'text-slate-400 hover:text-white border border-transparent'" class="px-3 py-1.5 rounded-md transition-colors">Today</button>
                    <button @click="setPeriod('7days')" :class="period === '7days' ? 'bg-white/10 text-white shadow-sm border border-white/5' : 'text-slate-400 hover:text-white border border-transparent'" class="px-3 py-1.5 rounded-md transition-colors">7 Days</button>
                    <button @click="setPeriod('30days')" :class="period === '30days' ? 'bg-white/10 text-white shadow-sm border border-white/5' : 'text-slate-400 hover:text-white border border-transparent'" class="px-3 py-1.5 rounded-md transition-colors">30 Days</button>
                    <button x-ref="datePickerBtn" :class="period === 'custom' ? 'bg-brand/20 text-brand-light shadow-sm border border-brand/30' : 'text-slate-400 hover:text-white border border-transparent'" class="px-3 py-1.5 rounded-md transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                        <span x-text="customDateLabel"></span>
                    </button>
                </div>
            </div>
        </header>

        <div class="p-8 max-w-7xl mx-auto w-full space-y-6 pb-24">
            <!-- Stat Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-bg-card border border-white/5 rounded-2xl p-6 shadow-lg hover:border-white/10 transition-colors">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-10 h-10 rounded-full bg-blue-500/10 text-blue-400 flex items-center justify-center text-lg font-bold">$</div>
                        <span class="text-xs font-medium flex items-center gap-1" :class="current.profitDir === 'up' ? 'text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded' : 'text-red-400 bg-red-400/10 px-2 py-0.5 rounded'">
                            <span x-text="current.profitTrend"></span>
                        </span>
                    </div>
                    <h3 class="text-3xl font-extrabold text-white mb-1 tracking-tight" x-text="current.profit"></h3>
                    <p class="text-sm text-slate-400 font-medium">Net Profit</p>
                </div>
                <div class="bg-bg-card border border-white/5 rounded-2xl p-6 shadow-lg hover:border-white/10 transition-colors">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-10 h-10 rounded-full bg-purple-500/10 text-purple-400 flex items-center justify-center">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                        </div>
                        <span class="text-xs font-medium flex items-center gap-1" :class="current.ordersDir === 'up' ? 'text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded' : 'text-red-400 bg-red-400/10 px-2 py-0.5 rounded'">
                            <span x-text="current.ordersTrend"></span>
                        </span>
                    </div>
                    <h3 class="text-3xl font-extrabold text-white mb-1 tracking-tight" x-text="current.orders"></h3>
                    <p class="text-sm text-slate-400 font-medium">Total Orders</p>
                </div>
                <div class="bg-bg-card border border-white/5 rounded-2xl p-6 shadow-lg hover:border-white/10 transition-colors">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-10 h-10 rounded-full bg-cyan-500/10 text-cyan-400 flex items-center justify-center text-lg font-bold">$</div>
                        <span class="text-xs font-medium flex items-center gap-1" :class="current.revenueDir === 'up' ? 'text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded' : 'text-red-400 bg-red-400/10 px-2 py-0.5 rounded'">
                            <span x-text="current.revenueTrend"></span>
                        </span>
                    </div>
                    <h3 class="text-3xl font-extrabold text-white mb-1 tracking-tight" x-text="current.revenue"></h3>
                    <p class="text-sm text-slate-400 font-medium">Gross Revenue</p>
                </div>
                <div class="bg-bg-card border border-white/5 rounded-2xl p-6 shadow-lg hover:border-white/10 transition-colors">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-10 h-10 rounded-full bg-brand/10 text-brand-light flex items-center justify-center">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
                        </div>
                        <span class="text-xs font-medium text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded flex items-center gap-1">Live Status</span>
                    </div>
                    <h3 class="text-3xl font-extrabold text-white mb-1 tracking-tight">56,097</h3>
                    <p class="text-sm text-slate-400 font-medium">Active Monitored Listings</p>
                </div>
            </div>

            <!-- Chart + Action Required -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-bg-card border border-white/5 rounded-2xl p-6 shadow-lg flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-bold text-white">Financial Overview (<span x-text="periodLabel"></span>)</h3>
                        <div class="flex gap-4 text-xs font-medium">
                            <span class="flex items-center gap-2"><span class="w-2.5 h-2.5 rounded-full bg-blue-500 shadow-[0_0_8px_#3b82f6]"></span> Revenue</span>
                            <span class="flex items-center gap-2"><span class="w-2.5 h-2.5 rounded-full bg-purple-500 shadow-[0_0_8px_#a855f7]"></span> Profit</span>
                        </div>
                    </div>
                    <div id="salesChart" class="w-full h-72 flex-1"></div>
                </div>

                <!-- Action Required -->
                <div class="bg-bg-card border border-white/5 rounded-2xl p-6 shadow-lg flex flex-col relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-red-500/10 blur-[50px] rounded-full pointer-events-none"></div>
                    <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                        <svg class="w-5 h-5 text-brand-light" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>
                        Action Required
                    </h3>
                    <div class="space-y-4 flex-1">
                        <div class="bg-red-500/10 border border-red-500/20 rounded-xl p-4 flex gap-3">
                            <div class="mt-0.5"><svg class="w-5 h-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div>
                            <div>
                                <p class="text-sm font-bold text-red-400 mb-1">3 Orders Failed to Process</p>
                                <p class="text-xs text-slate-400 mb-3">Your Amazon buyer account credit card was declined.</p>
                                <a href="/settings" class="text-xs font-bold text-white bg-red-500/20 hover:bg-red-500/30 px-3 py-1.5 rounded transition-colors inline-block">Update Billing</a>
                            </div>
                        </div>
                        <div class="bg-yellow-500/10 border border-yellow-500/20 rounded-xl p-4 flex gap-3 items-center">
                            <div class="shrink-0"><svg class="w-5 h-5 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg></div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-bold text-yellow-400">12 Products Out of Stock</p>
                            </div>
                            <a href="/products" class="text-xs font-bold text-slate-300 hover:text-white shrink-0">View</a>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-white/5 flex items-center justify-between text-xs">
                        <span class="text-slate-400">API Connection</span>
                        <span class="flex items-center gap-1.5 text-emerald-400 font-bold">
                            <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse shadow-[0_0_5px_#34d399]"></span>
                            Healthy
                        </span>
                    </div>
                </div>
            </div>

            <!-- Live Feed + Top Performers -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Live Automation Feed -->
                <div class="bg-bg-card border border-white/5 rounded-2xl p-6 shadow-lg">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-white flex items-center gap-2">
                            <svg class="w-5 h-5 text-brand-light" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                            Live Automation Feed
                        </h3>
                        <span class="bg-white/5 border border-white/10 text-slate-400 text-xs px-2 py-1 rounded">Last 2 hours</span>
                    </div>
                    <div class="relative border-l border-white/10 ml-3 space-y-6">
                        <div class="relative pl-6">
                            <div class="absolute -left-1.5 top-1.5 w-3 h-3 bg-brand rounded-full border-2 border-bg-card shadow-[0_0_8px_#8b5cf6]"></div>
                            <p class="text-sm font-bold text-white">Auto-Ordered Item #28134</p>
                            <p class="text-xs text-slate-400 mt-1">Purchased 'Wireless Earbuds' from Amazon for $12.50. Shipped to Jane Doe.</p>
                            <span class="text-[10px] text-slate-500 font-medium mt-2 block">12 mins ago</span>
                        </div>
                        <div class="relative pl-6">
                            <div class="absolute -left-1.5 top-1.5 w-3 h-3 bg-blue-500 rounded-full border-2 border-bg-card"></div>
                            <p class="text-sm font-bold text-white">Tracking Uploaded</p>
                            <p class="text-xs text-slate-400 mt-1">Uploaded tracking TBA9384218 to eBay order #99381.</p>
                            <span class="text-[10px] text-slate-500 font-medium mt-2 block">45 mins ago</span>
                        </div>
                        <div class="relative pl-6">
                            <div class="absolute -left-1.5 top-1.5 w-3 h-3 bg-emerald-500 rounded-full border-2 border-bg-card"></div>
                            <p class="text-sm font-bold text-white">Dynamic Repricing Executed</p>
                            <p class="text-xs text-slate-400 mt-1">Supplier increased price by 5%. Automatically adjusted 14 eBay listings to maintain 25% margin.</p>
                            <span class="text-[10px] text-slate-500 font-medium mt-2 block">1 hr ago</span>
                        </div>
                        <div class="relative pl-6">
                            <div class="absolute -left-1.5 top-1.5 w-3 h-3 bg-slate-600 rounded-full border-2 border-bg-card"></div>
                            <p class="text-sm font-bold text-white">Inventory Sync</p>
                            <p class="text-xs text-slate-400 mt-1">Scanned 56,097 items. Marked 4 items as Out of Stock.</p>
                            <span class="text-[10px] text-slate-500 font-medium mt-2 block">1.5 hrs ago</span>
                        </div>
                    </div>
                    <button class="w-full mt-6 py-2.5 border border-white/5 rounded-lg text-sm text-slate-400 hover:text-white hover:bg-white/5 transition-colors font-medium">View Full Logs</button>
                </div>

                <!-- Top Performers -->
                <div class="bg-bg-card border border-white/5 rounded-2xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold text-white mb-6">Top Performers (30 Days)</h3>
                    <div class="space-y-4">
                        <div class="flex items-center gap-4 p-3 bg-white/[0.02] border border-white/5 rounded-xl hover:border-brand/30 transition-colors group cursor-pointer">
                            <span class="text-brand-light font-black w-4 text-center">1</span>
                            <div class="w-10 h-10 rounded bg-slate-800 border border-slate-700 flex-shrink-0 overflow-hidden">
                                <img src="https://placehold.co/100x100/1e293b/a78bfa?text=ITEM" class="w-full h-full object-cover opacity-80 group-hover:opacity-100" alt="">
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-bold text-white truncate">KING MOUNTAIN Canvas Iron on Patch 3.5x80</p>
                                <p class="text-xs text-slate-400 flex gap-3 mt-1"><span>42 sold</span> <span class="text-emerald-400">+$314 profit</span></p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4 p-3 bg-white/[0.02] border border-white/5 rounded-xl hover:border-brand/30 transition-colors group cursor-pointer">
                            <span class="text-slate-400 font-bold w-4 text-center">2</span>
                            <div class="w-10 h-10 rounded bg-slate-800 border border-slate-700 flex-shrink-0 overflow-hidden">
                                <img src="https://placehold.co/100x100/1e293b/a78bfa?text=ITEM" class="w-full h-full object-cover opacity-80 group-hover:opacity-100" alt="">
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-bold text-white truncate">Barber Tools Bag Barber Case Hair Travel</p>
                                <p class="text-xs text-slate-400 flex gap-3 mt-1"><span>28 sold</span> <span class="text-emerald-400">+$210 profit</span></p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4 p-3 bg-white/[0.02] border border-white/5 rounded-xl hover:border-brand/30 transition-colors group cursor-pointer">
                            <span class="text-slate-400 font-bold w-4 text-center">3</span>
                            <div class="w-10 h-10 rounded bg-slate-800 border border-slate-700 flex-shrink-0 overflow-hidden">
                                <img src="https://placehold.co/100x100/1e293b/a78bfa?text=ITEM" class="w-full h-full object-cover opacity-80 group-hover:opacity-100" alt="">
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-bold text-white truncate">Snake Plush Stuffed Animal Toy 40-inch</p>
                                <p class="text-xs text-slate-400 flex gap-3 mt-1"><span>19 sold</span> <span class="text-emerald-400">+$142 profit</span></p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4 p-3 bg-white/[0.02] border border-white/5 rounded-xl hover:border-brand/30 transition-colors group cursor-pointer">
                            <span class="text-slate-400 font-bold w-4 text-center">4</span>
                            <div class="w-10 h-10 rounded bg-slate-800 border border-slate-700 flex-shrink-0 overflow-hidden">
                                <img src="https://placehold.co/100x100/1e293b/a78bfa?text=ITEM" class="w-full h-full object-cover opacity-80 group-hover:opacity-100" alt="">
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-bold text-white truncate">Comfort Office Chair Mats for Hardwood</p>
                                <p class="text-xs text-slate-400 flex gap-3 mt-1"><span>15 sold</span> <span class="text-emerald-400">+$112 profit</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
{% endblock %}

{% block scripts %}
<script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('dashboardData', () => ({
                period: '7days',
                customDateLabel: 'Custom Date',
                chartInstance: null,

                db: {
                    'today': {
                        profit: 'A$142',
                        profitTrend: '↗️ 5%',
                        profitDir: 'up',
                        orders: '18',
                        ordersTrend: '↗️ 2%',
                        ordersDir: 'up',
                        revenue: 'A$680',
                        revenueTrend: '↗️ 8%',
                        revenueDir: 'up',
                        newProducts: '2',
                        chartCats: ['8am', '10am', '12pm', '2pm', '4pm', '6pm'],
                        chartData: [
                            [120, 150, 180, 140, 190, 210],
                            [80, 100, 120, 90, 130, 140],
                            [40, 50, 60, 50, 60, 70]
                        ]
                    },
                    '7days': {
                        profit: 'A$5,069',
                        profitTrend: '↘️ 36%',
                        profitDir: 'down',
                        orders: '577',
                        ordersTrend: '↗️ 23%',
                        ordersDir: 'up',
                        revenue: 'A$24,320',
                        revenueTrend: '↗️ 26%',
                        revenueDir: 'up',
                        newProducts: '0',
                        chartCats: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        chartData: [
                            [4400, 5000, 5600, 5900, 5700, 6200, 5800],
                            [2800, 3100, 3400, 3600, 3400, 3700, 3300],
                            [1600, 1900, 2200, 2300, 2300, 2500, 2500]
                        ]
                    },
                    '30days': {
                        profit: 'A$18,450',
                        profitTrend: '↗️ 12%',
                        profitDir: 'up',
                        orders: '2,104',
                        ordersTrend: '↗️ 8%',
                        ordersDir: 'up',
                        revenue: 'A$89,200',
                        revenueTrend: '↗️ 15%',
                        revenueDir: 'up',
                        newProducts: '14',
                        chartCats: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        chartData: [
                            [18000, 21000, 24000, 26200],
                            [12000, 14000, 16000, 17500],
                            [6000, 7000, 8000, 8700]
                        ]
                    },
                    'custom': {
                        profit: 'A$--',
                        profitTrend: '--',
                        profitDir: 'up',
                        orders: '--',
                        ordersTrend: '--',
                        ordersDir: 'up',
                        revenue: 'A$--',
                        revenueTrend: '--',
                        revenueDir: 'up',
                        newProducts: '--',
                        chartCats: ['Start', 'End'],
                        chartData: [[0, 0], [0, 0], [0, 0]]
                    }
                },

                get current() {
                    return this.db[this.period];
                },

                get periodLabel() {
                    if (this.period === 'today') return 'Today';
                    if (this.period === '7days') return 'Last 7 Days';
                    if (this.period === '30days') return 'Last 30 Days';
                    return this.customDateLabel;
                },

                setPeriod(newPeriod) {
                    this.period = newPeriod;
                    if (newPeriod !== 'custom') this.customDateLabel = 'Custom Date';
                    this.updateChart();
                },

                initDashboard() {
                    flatpickr(this.$refs.datePickerBtn, {
                        mode: "range",
                        dateFormat: "M j",
                        theme: "dark",
                        onClose: (selectedDates, dateStr) => {
                            if (dateStr && dateStr.includes('to')) {
                                this.period = 'custom';
                                this.customDateLabel = dateStr.replace(' to ', ' - ');
                                this.db.custom.profit = 'A$12,430';
                                this.db.custom.profitTrend = '↗️ 18%';
                                this.db.custom.profitDir = 'up';
                                this.db.custom.orders = '1,240';
                                this.db.custom.ordersTrend = '↗️ 10%';
                                this.db.custom.ordersDir = 'up';
                                this.db.custom.revenue = 'A$55,100';
                                this.db.custom.revenueTrend = '↗️ 22%';
                                this.db.custom.revenueDir = 'up';
                                this.db.custom.newProducts = '7';
                                this.db.custom.chartCats = ['Day 1', 'Day 2', 'Day 3', 'Day 4'];
                                this.db.custom.chartData = [[12000, 14000, 13500, 15600], [8000, 9500, 9000, 10500], [4000, 4500, 4500, 5100]];
                                this.updateChart();
                            }
                        }
                    });

                    let options = {
                        series: [
                            { name: 'Revenue', data: this.current.chartData[0] },
                            { name: 'Product Cost', data: this.current.chartData[1] },
                            { name: 'Profit', data: this.current.chartData[2] }
                        ],
                        chart: { type: 'area', height: 280, toolbar: { show: false }, background: 'transparent', fontFamily: 'Inter, sans-serif' },
                        colors: ['#3b82f6', '#22d3ee', '#a855f7'],
                        fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.3, opacityTo: 0.05, stops: [0, 90, 100] } },
                        dataLabels: { enabled: false },
                        stroke: { curve: 'smooth', width: 2 },
                        xaxis: { categories: this.current.chartCats, axisBorder: { show: false }, axisTicks: { show: false }, labels: { style: { colors: '#64748b' } } },
                        yaxis: { labels: { style: { colors: '#64748b' } } },
                        grid: { borderColor: 'rgba(255,255,255,0.05)', strokeDashArray: 4 },
                        theme: { mode: 'dark' },
                        legend: { show: false }
                    };
                    this.chartInstance = new ApexCharts(document.querySelector("#salesChart"), options);
                    this.chartInstance.render();
                },

                updateChart() {
                    if (!this.chartInstance) return;
                    this.chartInstance.updateOptions({
                        xaxis: { categories: this.current.chartCats }
                    });
                    this.chartInstance.updateSeries([
                        { data: this.current.chartData[0] },
                        { data: this.current.chartData[1] },
                        { data: this.current.chartData[2] }
                    ]);
                }
            }));
        });
    </script>
{% endblock %}
